---
import ProjectGrid from "../../components/sections/work-section/ProjectGrid.astro";
import WorkHero from "../../components/sections/work-section/WorkHero.astro";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

const allPosts = (await getCollection("case-studies"))
  .filter((p) => !p.data.draft)
  .sort(
    (a, b) =>
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );

// Build tag list preserving first-seen casing, but dedup by lowercase
const tagMap = new Map<string, string>();
for (const p of allPosts) {
  for (const raw of p.data.tags ?? []) {
    const t = String(raw).trim();
    if (!t) continue;
    const key = t.toLowerCase();
    if (!tagMap.has(key)) tagMap.set(key, t);
  }
}
const allTags = Array.from(tagMap.values()).sort((a, b) =>
  a.localeCompare(b, "en", { sensitivity: "base" })
);
---

<Layout title="Case Studies">
  <WorkHero />

  <!-- Keep only ONE id, use id="grid" so controls & scripts work -->
  <section id="grid" class="mx-auto max-w-7xl px-6 py-16">
    <header class="mx-auto mb-12">
      <h2
        class="text-balance mt-2 text-2xl font-semibold leading-tight sm:mt-3 sm:text-4xl md:text-5xl text-center"
      >
        <span class="text-indigo-600">Protize</span> case studies.
      </h2>

      <p
        class="mt-3 max-w-2xl text-sm text-neutral-600 sm:text-base md:mt-4 text-center mx-auto"
      >
        A curated selection of projects across fintech, gaming, e-commerce, and
        platform engineering. Every build focuses on performance, reliability,
        and a great developer experience.
      </p>

      <!-- Filter Pills -->
      <div class="relative mt-6 sm:mt-8">
        <div
          class="pointer-events-none absolute inset-y-0 left-0 w-6 bg-gradient-to-r from-white to-transparent sm:hidden"
        >
        </div>
        <div
          class="pointer-events-none absolute inset-y-0 right-0 w-6 bg-gradient-to-l from-white to-transparent sm:hidden"
        >
        </div>

        <div
          id="filters"
          role="tablist"
          aria-label="Filter case studies by tag"
          class="flex snap-x snap-mandatory items-center gap-2 overflow-x-auto pb-1 sm:flex-wrap sm:overflow-visible sm:gap-3"
        >
          <button
            type="button"
            class="filter-pill active snap-start shrink-0 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 px-3 py-1.5 text-xs font-semibold text-white shadow-md transition-all duration-300 hover:shadow-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2 sm:px-4 sm:py-2 sm:text-sm"
            data-tag="*"
            role="tab"
            aria-selected="true"
            aria-controls="grid"
          >
            All
          </button>

          {
            allTags.map((t: string) => (
              <button
                type="button"
                class="filter-pill snap-start shrink-0 rounded-full border border-indigo-300 bg-white px-3 py-1.5 text-xs font-medium text-indigo-700 shadow-sm transition-all duration-300 hover:border-indigo-500 hover:bg-indigo-50 hover:text-indigo-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2 sm:px-4 sm:py-2 sm:text-sm"
                data-tag={t}
                role="tab"
                aria-selected="false"
                aria-controls="grid"
              >
                {t}
              </button>
            ))
          }
        </div>
      </div>
    </header>

    <ProjectGrid posts={allPosts} />
  </section>

  <!-- Process -->
  <section class="relative">
    <!-- Soft background glow -->
    <div
      aria-hidden="true"
      class="pointer-events-none absolute inset-x-0 top-0 -z-10 h-64 bg-gradient-to-b from-indigo-50/80 via-white to-transparent"
    >
    </div>

    <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8 py-14 sm:py-16">
      <header class="max-w-3xl text-center mx-auto mb-14">
        <p
          class="text-xs font-semibold uppercase tracking-widest text-indigo-600"
        >
          Our Process
        </p>
        <h2
          class="mt-2 text-2xl font-bold text-gray-900 sm:text-3xl md:text-4xl"
        >
          How we deliver
        </h2>
        <p class="mt-3 text-sm leading-6 text-gray-600 sm:text-base">
          Lean, measurable, and production-first. We align KPIs, ship fast, and
          scale what works.
        </p>
      </header>

      <!-- Cards -->
      <div
        class="mt-8 grid gap-4 sm:gap-6 md:gap-8 sm:grid-cols-2 lg:grid-cols-3"
      >
        <!-- Card 1 -->
        <article
          class="group relative rounded-2xl border border-neutral-200/70 bg-white p-6 shadow-sm transition-all duration-300 hover:-translate-y-0.5 hover:shadow-md"
        >
          <!-- Step badge -->
          <div
            class="absolute -top-3 left-6 inline-flex items-center gap-1 rounded-full bg-indigo-600 px-2.5 py-1 text-xs font-semibold text-white shadow-sm"
          >
            <span>01</span>
            <span class="opacity-80">Discover</span>
          </div>

          <!-- Icon -->
          <div
            class="mb-4 inline-flex h-11 w-11 items-center justify-center rounded-xl bg-indigo-50 text-indigo-600 ring-1 ring-inset ring-indigo-100 group-hover:ring-indigo-200"
          >
            <!-- Compass icon -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm3.53 6.47-2.02 4.72a1 1 0 0 1-.58.58l-4.72 2.02a.5.5 0 0 1-.65-.65l2.02-4.72a1 1 0 0 1 .58-.58l4.72-2.02a.5.5 0 0 1 .65.65Z"
              ></path>
            </svg>
          </div>

          <h3 class="font-semibold text-gray-900">
            Scope &amp; Success Metrics
          </h3>
          <p class="mt-2 text-sm text-neutral-600">
            KPI alignment, architecture options, and a pragmatic roadmap.
          </p>

          <ul class="mt-4 space-y-2 text-sm text-neutral-600">
            <li class="flex items-start gap-2">
              <span class="mt-1 h-1.5 w-1.5 rounded-full bg-indigo-500"></span>
              Discovery workshops &amp; feasibility
            </li>
            <li class="flex items-start gap-2">
              <span class="mt-1 h-1.5 w-1.5 rounded-full bg-indigo-500"></span>
              Risk/impact matrix &amp; success criteria
            </li>
          </ul>
        </article>

        <!-- Card 2 -->
        <article
          class="group relative rounded-2xl border border-neutral-200/70 bg-white p-6 shadow-sm transition-all duration-300 hover:-translate-y-0.5 hover:shadow-md"
        >
          <div
            class="absolute -top-3 left-6 inline-flex items-center gap-1 rounded-full bg-purple-600 px-2.5 py-1 text-xs font-semibold text-white shadow-sm"
          >
            <span>02</span>
            <span class="opacity-80">Build</span>
          </div>

          <div
            class="mb-4 inline-flex h-11 w-11 items-center justify-center rounded-xl bg-purple-50 text-purple-600 ring-1 ring-inset ring-purple-100 group-hover:ring-purple-200"
          >
            <!-- Rocket icon -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M14 4c-3.866 0-7 3.134-7 7 0 .586.076 1.154.219 1.696L3 17v4h4l4.304-4.219A7.007 7.007 0 0 0 21 11c0-3.866-3.134-7-7-7Zm-5 7a5 5 0 1 1 10.001.001A5 5 0 0 1 9 11Z"
              ></path>
            </svg>
          </div>

          <h3 class="font-semibold text-gray-900">Sprint &amp; Ship</h3>
          <p class="mt-2 text-sm text-neutral-600">
            Tight feedback loops, production-ready code, and observability baked
            in.
          </p>

          <ul class="mt-4 space-y-2 text-sm text-neutral-600 0">
            <li class="flex items-start gap-2">
              <span class="mt-1 h-1.5 w-1.5 rounded-full bg-purple-500"></span>
              CI/CD, quality gates, and preview envs
            </li>
            <li class="flex items-start gap-2">
              <span class="mt-1 h-1.5 w-1.5 rounded-full bg-purple-500"></span>
              Security checks &amp; performance budgets
            </li>
          </ul>
        </article>

        <!-- Card 3 -->
        <article
          class="group relative rounded-2xl border border-neutral-200/70 bg-white p-6 shadow-sm transition-all duration-300 hover:-translate-y-0.5 hover:shadow-md"
        >
          <div
            class="absolute -top-3 left-6 inline-flex items-center gap-1 rounded-full bg-violet-600 px-2.5 py-1 text-xs font-semibold text-white shadow-sm"
          >
            <span>03</span>
            <span class="opacity-80">Scale</span>
          </div>

          <div
            class="mb-4 inline-flex h-11 w-11 items-center justify-center rounded-xl bg-violet-50 text-violet-600 ring-1 ring-inset ring-violet-100 group-hover:ring-violet-200"
          >
            <!-- Chart icon -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path d="M4 3h2v18H4V3Zm7 6h2v12h-2V9Zm7-4h2v16h-2V5Z"></path>
            </svg>
          </div>

          <h3 class="font-semibold text-gray-900">Operate &amp; Optimize</h3>
          <p class="mt-2 text-sm text-neutral-600">
            Perf budgets, cost controls, A/B tests, and growth experiments.
          </p>

          <ul class="mt-4 space-y-2 text-sm text-neutral-600 0">
            <li class="flex items-start gap-2">
              <span class="mt-1 h-1.5 w-1.5 rounded-full bg-violet-500"></span>
              SLOs/alerts, autoscaling, and cost guardrails
            </li>
            <li class="flex items-start gap-2">
              <span class="mt-1 h-1.5 w-1.5 rounded-full bg-violet-500"></span>
              Experimentation &amp; cohort insights
            </li>
          </ul>
        </article>
      </div>

      <!-- Optional CTA -->
      <div class="mt-10 text-center">
        <a
          href="/contact-us"
          class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2"
        >
          Start a project
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M13 5l7 7-7 7v-4H4v-6h9V5z"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="relative pb-16">
    <!-- soft glow behind the card -->
    <div
      aria-hidden="true"
      class="pointer-events-none absolute inset-x-0 -top-10 -z-10 h-40 bg-gradient-to-b from-indigo-500/10 via-fuchsia-500/10 to-transparent blur-2xl"
    >
    </div>

    <div class="mx-auto w-full max-w-7xl px-4 sm:px-6 md:px-8">
      <div
        class="rounded-3xl bg-gradient-to-tr from-indigo-600 to-fuchsia-500 p-[2px] shadow-[0_10px_30px_-10px_rgba(79,70,229,0.35)]"
      >
        <div class="rounded-3xl bg-white/90 p-6 sm:p-8 md:p-10 backdrop-blur">
          <div
            class="flex flex-col items-start justify-between gap-6 md:flex-row md:items-center"
          >
            <!-- Left: Copy -->
            <div class="max-w-2xl">
              <div
                class="inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1 text-xs font-semibold text-indigo-700 ring-1 ring-inset ring-indigo-100"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  ><path
                    d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm1 11h3l-4 5-4-5h3V6h2v7Z"
                  ></path></svg
                >
                Available for new projects
              </div>
              <h3
                class="mt-3 text-xl font-semibold text-gray-900 sm:text-2xl md:text-3xl"
              >
                Have a project in mind?
              </h3>
              <p class="mt-1 text-sm text-neutral-600 sm:text-base">
                Let’s bring it to life with Protize—fast, reliable, and
                production-ready.
              </p>
            </div>

            <!-- Right: Actions -->
            <div
              class="flex w-full flex-col items-stretch gap-3 sm:flex-row sm:items-center sm:justify-end md:w-auto"
            >
              <a
                href="/contact-us"
                class="inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 px-5 py-3 text-sm font-semibold text-white shadow-sm transition hover:shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2"
              >
                Start a conversation
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  ><path d="M13 5l7 7-7 7v-4H4v-6h9V5z"></path></svg
                >
              </a>

              <a
                href="/blog"
                class="inline-flex items-center justify-center gap-2 rounded-xl border border-indigo-200 bg-white px-5 py-3 text-sm font-medium text-indigo-700 transition hover:border-indigo-400 hover:bg-indigo-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-300 focus-visible:ring-offset-2"
              >
                View our Blogs
              </a>
            </div>
          </div>

          <!-- tiny footer line -->
          <div class="mt-4 text-xs text-neutral-500">
            Typical kickoff in 7–10 days · NDA-friendly · India & global clients
          </div>
        </div>
      </div>
    </div>
  </section>

  <script type="module">
    const grid = document.getElementById("grid");
    const pills = Array.from(document.querySelectorAll(".filter-pill"));

    const activeClasses =
      "bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md border-transparent";
    const inactiveClasses =
      "border border-indigo-300 bg-white text-indigo-700 hover:border-indigo-500 hover:text-indigo-900 hover:bg-indigo-50";

    function setActive(btn) {
      pills.forEach((b) => {
        const isActive = b === btn;
        if (isActive) {
          b.classList.add(...activeClasses.split(" "));
          b.classList.remove(...inactiveClasses.split(" "));
          b.setAttribute("aria-selected", "true");
        } else {
          b.classList.remove(...activeClasses.split(" "));
          b.classList.add(...inactiveClasses.split(" "));
          b.setAttribute("aria-selected", "false");
        }
      });
    }

    pills.forEach((btn) => {
      btn.addEventListener("click", () => {
        setActive(btn);
        const tag = (btn.dataset.tag ?? "*").toLowerCase();

        grid?.dispatchEvent(
          new CustomEvent("protize:filter-change", { detail: { tag } })
        );

        const url = new URL(window.location.href);
        if (tag === "*") url.searchParams.delete("tag");
        else url.searchParams.set("tag", tag);
        window.history.replaceState({}, "", url);
      });
    });

    // Initialize from ?tag=, case-insensitive
    const initTag = (
      new URL(window.location.href).searchParams.get("tag") || "*"
    ).toLowerCase();
    if (initTag !== "*") {
      const match = pills.find(
        (b) => (b.dataset.tag ?? "").toLowerCase() === initTag
      );
      if (match) match.click();
    }
  </script>
</Layout>
