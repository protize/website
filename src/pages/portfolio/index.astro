---
import Layout from "../../layouts/Layout.astro";
import FadeIn from "../../components/animations/FadeIn";
import { getCollection } from "astro:content";
import PortfolioHero from "../../components/portfolio/PortfolioHero.astro";
import PortfolioStats from "../../components/portfolio/PortfolioStats.astro";
import PortfolioGrid from "../../components/portfolio/PortfolioGrid.astro";
import CTASection from "../../components/home/CTASection.astro";

// Get all portfolio entries
const portfolioEntries = await getCollection("portfolio");

// Sort by date (newest first)
const projects = portfolioEntries
  .sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
  )
  .map((entry) => ({
    id: entry.id,
    slug: entry.slug,
    ...entry.data,
  }));

// âœ… Get unique categories safely + ensure "All" first + remove empty
const categories = [
  "All",
  ...Array.from(new Set(projects.map((p) => p.category).filter(Boolean))),
];
---

<Layout title="Portfolio">
  <!-- Hero Section -->
  <PortfolioHero />

  <!-- Stats Overview -->
  <PortfolioStats />

  <!-- Portfolio Grid -->
  <PortfolioGrid categories={categories} projects={projects} />

  <!-- CTA Section -->

  <CTASection
    title="Ready to Start Your Project?"
    subtitle="Let's discuss how we can help you achieve similar results for your business"
    actions={[
      {
        label: "Get Started",
        href: "/contact-us",
        variant: "primary",
        icon: true,
      },
      { label: "View Services", href: "/services", variant: "outline" },
    ]}
  />
</Layout>
