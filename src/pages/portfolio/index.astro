---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import PortfolioHero from "../../components/sections/portfolio-section/PortfolioHero.astro";
import ProjectGrid from "../../components/sections/portfolio-section/ProjectGrid.astro";
import Container from "../../components/shared/Container.astro";
import Title from "../../components/shared/Title.astro";
import Paragraph from "../../components/shared/Paragraph.astro";
import TestimonialsCarousel from "../../components/sections/TestimonialsCarousel";
import TeamGrid from "../../components/sections/team-section/TeamGrid.astro";
import { members } from "../../utils/data";
import KpiResults from "../../components/sections/portfolio-section/KpiResults.astro";

const allPosts = (await getCollection("portfolio"))
  .filter((p) => !p.data.draft)
  .sort(
    (a, b) =>
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime(),
  );

const tagMap = new Map<string, string>();
for (const p of allPosts) {
  for (const raw of p.data.tags ?? []) {
    const t = String(raw).trim();
    if (!t) continue;
    const key = t.toLowerCase();
    if (!tagMap.has(key)) tagMap.set(key, t);
  }
}
const allTags = Array.from(tagMap.values()).sort((a, b) =>
  a.localeCompare(b, "en", { sensitivity: "base" }),
);
---

<Layout title="Portfolio">
  <section>
    <PortfolioHero />
    <!-- <Experience /> -->
    <Container className="mb-10">
      <div class="text-center space-y-4 pt-16 pb-4" id="project-grid">
        <Title>Projects</Title>
        <Paragraph
          >Explore my projects and know about development journey</Paragraph
        >
      </div>
      <ProjectGrid posts={allPosts} />
      <KpiResults />

      <TeamGrid
        title="Our Creative Team"
        subtitle="Our Team Members"
        description="We are a multidisciplinary crew crafting products and delightful experiences."
        members={members}
      />
    </Container>
    <TestimonialsCarousel client:load />
  </section>
</Layout>
