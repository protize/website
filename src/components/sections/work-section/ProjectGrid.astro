---
import Container from "../../shared/Container.astro";

export interface Props {
  className?: string;
}

const { className = "" } = Astro.props;

type Project = {
  title: string;
  client: string;
  summary: string;
  tags: string[];
  cover: string;
  href?: string;
};

const projects: Project[] = [
  {
    title: "Scalable Payments Dashboard",
    client: "Protize / Fintech",
    summary: "Next.js + NestJS + Timeseries analytics; 1M+ tx/day readiness.",
    tags: ["Fintech", "Analytics", "Dashboards"],
    cover:
      "https://images.unsplash.com/photo-1551281044-8e146f39609e?q=80&w=1600&auto=format&fit=crop",
    href: "/case-studies/payments-dashboard",
  },
  {
    title: "Gaming Onboarding Suite",
    client: "APAC Games",
    summary: "Merchant KYC, automated risk checks, T+1 settlements.",
    tags: ["Gaming", "Onboarding", "Automation"],
    cover:
      "https://images.unsplash.com/photo-1511512578047-dfb367046420?q=80&w=1600&auto=format&fit=crop",
  },
  {
    title: "Realtime Alerting & Ops",
    client: "Quami",
    summary: "Slack/Telegram bots for success-rate & wallet alerts.",
    tags: ["DevOps", "Automation", "Bots"],
    cover:
      "https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=1600&auto=format&fit=crop",
  },
  {
    title: "E-commerce Accelerator",
    client: "SKE Clothing",
    summary: "WooCommerce + S3 image pipeline + SEO product feeds.",
    tags: ["E-commerce", "SEO", "Automation"],
    cover:
      "https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=1600&auto=format&fit=crop",
  },
  {
    title: "USDT Settlement Bridge",
    client: "Poco-PG",
    summary: "Multi-currency settlements with risk-tiered tariffs.",
    tags: ["Fintech", "Crypto", "Backoffice"],
    cover:
      "https://images.unsplash.com/photo-1640340434866-05d4fd8caac5?q=80&w=1600&auto=format&fit=crop",
  },
  {
    title: "WordPress Site Factory",
    client: "Protize Studio",
    summary: "Hostinger + WP AI builder prompts, 50+ verticals.",
    tags: ["WordPress", "Content", "Automation"],
    cover:
      "https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=1600&auto=format&fit=crop",
  },
];

const allTags = Array.from(new Set(projects.flatMap((p) => p.tags))).sort();
---

<section id="project-grid" class={`relative ${className}`}>
  <Container>
    <header class="mx-auto max-w-6xl">
      <h1
        class="mt-3 text-3xl font-semibold leading-tight sm:text-4xl md:text-5xl"
      >
        Shipping fast. Scaling reliably. <span class="text-indigo-600"
          >Protize</span
        > case studies.
      </h1>
      <p class="mt-4 max-w-2xl text-neutral-600">
        A curated selection of projects across fintech, gaming, e-commerce, and
        platform engineering. Every build focuses on performance, reliability,
        and a great developer experience.
      </p>

      <!-- Filter Pills -->
      <div
        class="mt-6 flex flex-wrap gap-2"
        id="filters"
        role="tablist"
        aria-label="Filter case studies by tag"
      >
        <button
          type="button"
          class="filter-pill active"
          data-tag="*"
          role="tab"
          aria-selected="true"
          aria-controls="grid"
        >
          All
        </button>
        {
          allTags.map((t: string) => (
            <button
              type="button"
              class="filter-pill"
              data-tag={t}
              role="tab"
              aria-selected="false"
              aria-controls="grid"
            >
              {t}
            </button>
          ))
        }
      </div>
    </header>

    <div class="mx-auto max-w-6xl">
      <div id="grid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {
          projects.map((p) => (
            <article
              class="group rounded-2xl border border-neutral-200/70 bg-white shadow-sm transition hover:shadow-md"
              data-tags={p.tags.join(",")}
            >
              <a
                href={p.href ?? "#"}
                class="block focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 rounded-2xl"
              >
                <div class="overflow-hidden rounded-t-2xl">
                  <img
                    src={p.cover}
                    alt={p.title}
                    loading="lazy"
                    decoding="async"
                    class="h-52 w-full object-cover transition duration-300 group-hover:scale-[1.03]"
                  />
                </div>
                <div class="p-5">
                  <div class="flex items-center justify-between gap-3">
                    <h3 class="text-lg font-semibold text-neutral-900">
                      {p.title}
                    </h3>
                    <span class="rounded-full bg-indigo-50 px-3 py-1 text-xs font-medium text-indigo-700">
                      {p.tags[0]}
                    </span>
                  </div>
                  <p class="mt-1 text-sm text-neutral-500">{p.client}</p>
                  <p class="mt-3 text-sm leading-relaxed text-neutral-700">
                    {p.summary}
                  </p>
                  <div class="mt-4 flex flex-wrap gap-2">
                    {p.tags.map((t: string) => (
                      <span class="rounded-full border border-neutral-200 px-2.5 py-1 text-xs text-neutral-600">
                        {t}
                      </span>
                    ))}
                  </div>
                  <div class="mt-5 inline-flex items-center gap-2 text-sm font-medium text-indigo-600">
                    View details
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      />
                    </svg>
                  </div>
                </div>
              </a>
            </article>
          ))
        }
      </div>
    </div>
  </Container>
</section>

<style is:global>
  .filter-pill {
    @apply rounded-full border border-neutral-200 bg-white px-3 py-1.5 text-xs font-medium text-neutral-700 transition hover:border-indigo-300 hover:text-indigo-600 dark:border-white/10 dark:bg-neutral-900 dark:text-neutral-300;
  }
  .filter-pill.active {
    @apply border-indigo-500 text-indigo-600;
  }
</style>

<script>
  const grid = document.getElementById("grid");
  const cards = Array.from(grid?.children ?? []);
  const pills = Array.from(document.querySelectorAll(".filter-pill"));

  function applyFilter(tag: string) {
    cards.forEach((card) => {
      if (tag === "*") {
        card.classList.remove("hidden");
        return;
      }
      const badges = Array.from(card.querySelectorAll("span")).map(
        (s) => s.textContent?.trim() ?? ""
      );
      const has = badges.some((b) => b === tag);
      card.classList.toggle("hidden", !has);
    });
  }

  pills.forEach((p) => {
    p.addEventListener("click", () => {
      pills.forEach((x) => x.classList.remove("active"));
      p.classList.add("active");
      const tag = p.getAttribute("data-tag") || "*";
      applyFilter(tag);
    });
  });
</script>
