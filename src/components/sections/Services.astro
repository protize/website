---
import Container from "../shared/Container.astro";
import Title from "../shared/Title.astro";
import CtaButton from "../shared/CtaButton.astro";
import { services, type ServiceItem } from "../../data/service";
import { InteractiveCard } from "../lightswind/interactive-card";

export interface Props {
  className?: string;
}

const { className = "" } = Astro.props;
---

<section id="services" class={`relative bg-gray-50 ${className}`}>
  <Container className="space-y-8 md:space-y-10">
    <div class="text-center max-w-4xl mx-auto space-y-2">
      <Title>Why Businesses Choose Protize</Title>
      <p class="text-sm md:text-base text-gray-600">
        We build secure, scalable products across industries—delivered with
        clear communication, predictable timelines, and long-term support.
      </p>
    </div>

    <div
      id="services-grid"
      class="flex flex-wrap justify-center gap-4 md:gap-6"
    >
      {
        services.slice(0, 8).map((service: ServiceItem, idx: number) => (
          <div class="service-reveal" style={`--delay:${idx * 90}ms`}>
            <InteractiveCard InteractiveColor="#a3d9f3" client:load>
              <div class="flex items-start gap-3 rounded-xl px-4 py-10">
                <div
                  class={`inline-flex h-11 w-11 shrink-0 items-center justify-center rounded-xl ring-1 shadow-sm ${service.iconClass ?? "text-blue-600 ring-blue-100 bg-blue-50"}`}
                >
                  {service.icon && <service.icon strokeWidth={2.1} />}
                </div>

                <div class="min-w-0">
                  <h3 class="text-base md:text-lg font-semibold text-slate-900 leading-tight">
                    {service.title}
                  </h3>

                  {service.features?.length > 0 && (
                    <ul class="mt-3 space-y-1.5">
                      {service.features.slice(0, 4).map((feature: string) => (
                        <li class="text-sm text-slate-600 leading-relaxed">
                          • {feature}
                        </li>
                      ))}
                    </ul>
                  )}
                </div>
              </div>
            </InteractiveCard>
          </div>
        ))
      }
    </div>

    <div class="text-center">
      <a href="/services"><CtaButton>Explore Our Services</CtaButton></a>
    </div>
  </Container>
</section>

<script>
  const grid = document.getElementById("services-grid");

  if (grid) {
    const prefersReducedMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)",
    ).matches;

    if (prefersReducedMotion) {
      grid.classList.add("services-visible");
    } else {
      const observer = new IntersectionObserver(
        ([entry], obs) => {
          if (entry.isIntersecting) {
            grid.classList.add("services-visible");
            obs.disconnect();
          }
        },
        { threshold: 0.2, rootMargin: "0px 0px -8% 0px" },
      );

      observer.observe(grid);
    }
  }
</script>

<style>
  .service-reveal {
    opacity: 0;
    transform: translateY(18px) scale(0.98);
    will-change: transform, opacity;
  }

  #services-grid.services-visible .service-reveal {
    animation: serviceIn 0.65s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    animation-delay: var(--delay);
  }

  @keyframes serviceIn {
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .service-reveal {
      opacity: 1 !important;
      transform: none !important;
      animation: none !important;
    }
  }
</style>
