---
import Container from "../shared/Container.astro";
import Title from "../shared/Title.astro";

import GradiantText from "../shared/GradiantText.astro";
import { features } from "../../data/feature";
import { Image } from "astro:assets";

export interface Props {
  className?: string;
}

const { className = "" } = Astro.props;
---

<section id="features" class={`bg-white ${className}`}>
  <Container>
    <!-- Header -->
    <div class="text-center max-w-4xl mx-auto features-reveal features-head">
      <Title>
        We build <GradiantText>Essential Features</GradiantText> for Modern IT Products
      </Title>
      <p class="mt-2 text-sm md:text-base text-gray-600">
        From architecture to operationsâ€”Protize ships durable systems with
        measurable outcomes.
      </p>
    </div>

    <div
      class="max-w-6xl mx-auto mt-10 flex flex-col lg:flex-row gap-8 items-center"
    >
      <!-- Image -->
      <div class="relative w-full lg:w-2/3 features-reveal features-image">
        <div class="absolute -inset-6 rounded-3xl bg-purple-100/60 blur-2xl">
        </div>
        <Image
          src="/images/feature-tech-1.png"
          alt="Protize essential features illustration"
          width="640"
          height="480"
          loading="lazy"
          decoding="async"
          class="hero-image relative w-full max-w-xl mx-auto object-cover"
        />
      </div>

      <!-- Feature list -->
      <div class="w-full lg:w-1/3 flex flex-col mt-4 lg:mt-0">
        {
          features.map((feature, idx) => (
            <div
              class="features-item flex items-center text-heading-3 font-medium"
              style={`--delay:${idx * 90}ms`}
            >
              <span class="font-bold rounded-full w-8 h-8 mr-3 text-primary inline-flex justify-center items-center">
                &checkmark;
              </span>
              {feature.title}
            </div>
          ))
        }
      </div>
    </div>
  </Container>
</section>

<script>
  const section = document.getElementById("features");

  if (section) {
    const prefersReducedMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)",
    ).matches;

    if (prefersReducedMotion) {
      section.classList.add("features-visible");
    } else {
      const observer = new IntersectionObserver(
        ([entry], obs) => {
          if (entry.isIntersecting) {
            section.classList.add("features-visible");
            obs.disconnect();
          }
        },
        { threshold: 0.2, rootMargin: "0px 0px -8% 0px" },
      );

      observer.observe(section);
    }
  }
</script>

<style>
  /* Initial hidden state */
  #features .features-reveal,
  #features .features-item {
    opacity: 0;
    will-change: transform, opacity;
  }

  #features .features-head {
    transform: translateY(18px);
  }

  #features .features-image {
    transform: translateX(-22px) scale(0.985);
  }

  #features .features-item {
    transform: translateY(12px);
  }

  /* On visible */
  #features.features-visible .features-head {
    animation: fadeUp 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }

  #features.features-visible .features-image {
    animation: fadeSlideRight 0.75s cubic-bezier(0.22, 1, 0.36, 1) 0.1s forwards;
  }

  #features.features-visible .features-item {
    animation: fadeUp 0.55s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    animation-delay: var(--delay);
  }

  .hero-image {
    animation: floatY 6s ease-in-out 1.2s infinite;
    will-change: transform;
  }

  @keyframes floatY {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-10px);
    }
  }

  @keyframes fadeUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeSlideRight {
    to {
      opacity: 1;
      transform: translateX(0) scale(1);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    #features .features-reveal,
    #features .features-item {
      opacity: 1 !important;
      transform: none !important;
      animation: none !important;
    }
  }
</style>
