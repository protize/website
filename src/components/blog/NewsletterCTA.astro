---
import FadeIn from "../animations/FadeIn";

type Props = {
  title?: string;
  subtitle?: string;
  placeholder?: string;
  buttonText?: string;
  note?: string;

  // optional styling hooks
  className?: string;
  sectionClass?: string;
};

const {
  title = "Stay Updated",
  subtitle = "Get the latest articles, insights, and updates delivered directly to your inbox. No spam, unsubscribe anytime.",
  placeholder = "Enter your email",
  buttonText = "Subscribe Now",
  note = "",

  className = "",
  sectionClass = "section-padding bg-gradient-to-br from-primary/30 to-accent/30 text-black",
} = Astro.props as Props;
---

<section class={`${sectionClass} ${className}`}>
  <div class="container-custom text-center">
    <FadeIn client:load direction="up">
      <div class="max-w-3xl mx-auto">
        <h2 class="text-4xl md:text-5xl font-heading font-bold mb-6">
          {title}
        </h2>

        <p class="text-xl mb-8 opacity-90">{subtitle}</p>

        <form
          id="newsletter-form"
          class="flex flex-col sm:flex-row items-center justify-center gap-4 max-w-xl mx-auto"
        >
          <input
            type="hidden"
            name="access_key"
            value="6a7cc952-2c83-4eae-9ed5-780391faa21a"
          />
          <input
            type="hidden"
            name="subject"
            value="New Newsletter Subscription"
          />

          <input
            type="email"
            id="newsletter-email"
            name="email"
            placeholder={placeholder}
            class="w-auto sm:w-[360px] px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all"
            required
          />

          <button
            type="submit"
            id="newsletter-btn"
            class="btn-primary w-auto shrink-0 inline-flex items-center gap-2"
          >
            <span id="newsletter-btn-text">{buttonText}</span>
            <!-- Arrow (default) -->
            <svg
              id="newsletter-btn-arrow"
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
            </svg>
            <!-- Spinner (hidden by default) -->
            <svg
              id="newsletter-btn-spinner"
              class="w-5 h-5 animate-spin hidden"
              fill="none"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8v8z"></path>
            </svg>
          </button>
        </form>

        <p id="newsletter-result" class="text-sm mt-4 min-h-[20px] font-medium">
        </p>

        {note && <p class="text-sm opacity-75 mt-2">{note}</p>}
      </div>
    </FadeIn>
  </div>
</section>

<script>
  const form = document.getElementById("newsletter-form") as HTMLFormElement;
  const result = document.getElementById("newsletter-result")!;
  const btn = document.getElementById("newsletter-btn") as HTMLButtonElement;
  const btnText = document.getElementById("newsletter-btn-text")!;
  const arrow = document.getElementById("newsletter-btn-arrow")!;
  const spinner = document.getElementById("newsletter-btn-spinner")!;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Show loader
    btnText.textContent = "";
    btn.disabled = true;
    arrow.classList.add("hidden");
    spinner.classList.remove("hidden");

    const formData = new FormData(form);

    const response = await fetch("https://api.web3forms.com/submit", {
      method: "POST",
      body: formData,
    });

    const data = await response.json();

    if (data.success) {
      result.textContent = "âœ“ You're subscribed! Thank you.";
      result.className = "text-sm mt-4 min-h-[20px] font-medium text-green-600";
      form.reset();
    } else {
      result.textContent = "Something went wrong. Please try again.";
      result.className = "text-sm mt-4 min-h-[20px] font-medium text-red-500";
    }

    // Hide loader
    btnText.textContent = "Subscribe Now";
    btn.disabled = false;
    arrow.classList.remove("hidden");
    spinner.classList.add("hidden");
  });
</script>
