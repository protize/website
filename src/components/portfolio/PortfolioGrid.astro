---
// âœ… components/portfolio/PortfolioGrid.astro (UI upgraded)
import type { CollectionEntry } from "astro:content";
import FadeIn from "../animations/FadeIn";

type PortfolioProject = CollectionEntry<"portfolio">["data"] & {
  id: string;
  slug: string;
};

type Props = {
  categories: string[];
  projects: PortfolioProject[];
};

const { categories = ["All"], projects = [] } = Astro.props as Props;

const safeCategories = ["All", ...categories.filter((c) => c && c !== "All")];
---

<section class="section-padding relative">


  <div class="container-custom relative">
    <FadeIn client:load direction="up">
      <div class="text-center mb-10 md:mb-12">
        <h2 class="text-3xl md:text-5xl font-heading font-extrabold tracking-tight mb-3">
          Browse Our Work
        </h2>
        <p class="text-gray-600 max-w-2xl mx-auto">
          Hand-picked projects across web, mobile, and product engineering.
        </p>

        <!-- Category Filter: pill bar -->
        <div class="mt-8 flex justify-center">
          <div class="inline-flex flex-wrap justify-center gap-2 rounded-2xl border border-gray-200 bg-white/70 backdrop-blur px-2 py-2 shadow-sm">
            {
              safeCategories.map((category, i) => (
                <button
                  type="button"
                  data-category={category}
                  aria-pressed={i === 0 ? "true" : "false"}
                  class={`category-btn relative isolate rounded-xl px-4 md:px-5 py-2 text-sm md:text-[15px] font-semibold transition
                    focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/40
                    ${
                      i === 0
                        ? "bg-primary text-white shadow-md"
                        : "text-gray-700 hover:bg-gray-100 hover:text-black"
                    }`}
                >
                  <span class="relative z-10">{category}</span>
                </button>
              ))
            }
          </div>
        </div>
      </div>
    </FadeIn>

    <!-- Projects Grid -->
    <div id="projects-grid" class="grid gap-6 md:gap-8 md:grid-cols-2 lg:grid-cols-3">
  {
    projects.map((project, index) => (
      <div class="project-card" data-category={project.category}>
          <FadeIn client:load direction="up" delay={index * 0.01}>
            <a
              href={`/portfolio/${project.slug}`}
              class="project-card group block"
              data-category={project.category}
            >
              <article
                class="h-full rounded-2xl border border-gray-200 bg-white/80 backdrop-blur shadow-sm overflow-hidden transition
                       hover:-translate-y-1 hover:shadow-xl hover:border-gray-300"
              >
                <div class="relative h-56 md:h-60 flex items-center justify-center overflow-hidden bg-gradient-to-br from-primary/10 to-accent/10">
                  <div class="h-32 w-32 md:h-36 md:w-36 lg:h-48 lg:w-48 rounded-full overflow-hidden bg-white shadow-sm ring-1 ring-black/5 flex items-center justify-center">
                    <img
                      src={project.featuredImage}
                      alt={project.title}
                      class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
                      loading="lazy"
                    />
                  </div>

                  <div class="absolute top-4 left-4">
                    <span class="inline-flex items-center gap-2 rounded-full bg-white/90 text-gray-900 px-3 py-1 text-xs font-semibold border border-white/60 shadow-sm">
                      <span class="h-2 w-2 rounded-full bg-primary"></span>
                      {project.category}
                    </span>
                  </div>
                </div>
                
                <div class="p-6">
                  <div class="flex items-center justify-between gap-3 text-xs md:text-sm text-gray-500 mb-3">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                      <span>
                        {new Date(project.date).toLocaleDateString("en-US", {
                          month: "short",
                          year: "numeric",
                        })}
                      </span>
                    </div>

                    {project.client && (
                      <span class="inline-flex items-center gap-2 rounded-full bg-gray-100 text-gray-700 px-3 py-1 font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0z" />
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        {project.client}
                      </span>
                    )}
                  </div>

                  <h3 class="text-lg md:text-[19px] font-heading font-bold leading-snug mb-2 text-gray-900 group-hover:text-primary transition-colors">
                    {project.title}
                  </h3>

                  <p class="text-gray-600 leading-relaxed line-clamp-2 mb-4">
                    {project.shortDescription}
                  </p>

                  <!-- Tech tags -->
                  <div class="flex flex-wrap gap-2">
                    {project.technologies?.slice(0, 3).map((tech) => (
                      <span class="rounded-lg border border-gray-200 bg-white px-2.5 py-1 text-xs font-semibold text-gray-700">
                        {tech}
                      </span>
                    ))}
                    {project.technologies?.length > 3 && (
                      <span class="rounded-lg border border-gray-200 bg-white px-2.5 py-1 text-xs font-semibold text-gray-700">
                        +{project.technologies.length - 3}
                      </span>
                    )}
                  </div>

                  <!-- Bottom link -->
                  <div class="mt-5 flex items-center justify-between">
                    <span class="inline-flex items-center gap-2 text-primary font-semibold">
                      View Details
                      <svg class="w-4 h-4 transition-transform duration-300 group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                      </svg>
                    </span>

                    <span class="h-9 w-9 rounded-xl bg-primary/10 text-primary grid place-items-center transition group-hover:bg-primary group-hover:text-white">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                      </svg>
                    </span>
                  </div>
                </div>
              </article>
            </a>
          </FadeIn>
        </div>
        ))
      }
    </div>
  </div>
</section>

<script is:inline>
  function initPortfolioFilter() {
    const categoryBtns = document.querySelectorAll(".category-btn");
    const projectCards = document.querySelectorAll(".project-card");
    if (!categoryBtns.length || !projectCards.length) return;

    const setActiveBtn = (activeBtn) => {
      categoryBtns.forEach((b) => {
        b.classList.remove("bg-primary", "text-white", "shadow-md");
        b.classList.add("text-gray-700");
        b.setAttribute("aria-pressed", "false");
      });
      activeBtn.classList.add("bg-primary", "text-white", "shadow-md");
      activeBtn.classList.remove("text-gray-700");
      activeBtn.setAttribute("aria-pressed", "true");
    };

    const applyFilter = (category) => {
      projectCards.forEach((card) => {
        const projectCategory = card.getAttribute("data-category");
        const show = category === "All" || projectCategory === category;
        card.classList.toggle("hidden", !show); 
      });
    };

    const firstBtn = categoryBtns[0];
    if (firstBtn) {
      setActiveBtn(firstBtn);
      applyFilter(firstBtn.getAttribute("data-category") || "All");
    }

    categoryBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        const category = btn.getAttribute("data-category") || "All";
        setActiveBtn(btn);
        applyFilter(category);
      });
    });
  }

  document.addEventListener("DOMContentLoaded", initPortfolioFilter);
  document.addEventListener("astro:page-load", initPortfolioFilter);
</script>
