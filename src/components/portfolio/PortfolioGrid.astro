---
// âœ… components/portfolio/PortfolioGrid.astro (UI upgraded)
import type { CollectionEntry } from "astro:content";
import FadeIn from "../animations/FadeIn";
import ProjectCard from "./ProjectCard.astro";

type PortfolioProject = CollectionEntry<"portfolio">["data"] & {
  id: string;
  slug: string;
};

type Props = {
  categories: string[];
  projects: PortfolioProject[];
};

const { categories = ["All"], projects = [] } = Astro.props as Props;

const safeCategories = ["All", ...categories.filter((c) => c && c !== "All")];
---

<section id="work" class="section-padding relative">
  <div class="container-custom relative">
    <FadeIn client:load direction="up">
      <div class="text-center mb-10 md:mb-12">
        <h2
          class="text-4xl md:text-5xl font-heading font-extrabold tracking-tight mb-3"
        >
          Browse Our <span class="gradient-text">Work</span>
        </h2>
        <p class="text-gray-600 max-w-2xl mx-auto">
          Hand-picked projects across web, mobile, and product engineering.
        </p>

        <!-- Category Filter: pill bar -->
        <div class="mt-8 flex justify-center">
          <div
            class="inline-flex flex-wrap justify-center gap-2 rounded-2xl border border-gray-200 bg-white/70 backdrop-blur px-2 py-2 shadow-sm"
          >
            {
              safeCategories.map((category, i) => (
                <button
                  type="button"
                  data-category={category}
                  aria-pressed={i === 0 ? "true" : "false"}
                  class="category-btn relative isolate rounded-xl px-4 md:px-5 py-2 text-sm md:text-[15px] font-semibold transition
    focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/40
    text-gray-700 hover:bg-gray-100 hover:text-black"
                >
                  <span class="relative z-10">{category}</span>
                </button>
              ))
            }
          </div>
        </div>
      </div>

      <!-- Projects Grid -->
      <div
        id="projects-grid"
        class="grid gap-6 md:gap-8 md:grid-cols-2 lg:grid-cols-3 items-stretch"
      >
        {
          projects.map((project) => (
            <div
              class="project-card h-full flex"
              data-category={project.category}
            >
              <ProjectCard project={project} />
            </div>
          ))
        }
      </div>
    </FadeIn>
  </div>
</section>

<script is:inline>
  function initPortfolioFilter() {
    const categoryBtns = document.querySelectorAll(".category-btn");
    const projectCards = document.querySelectorAll(".project-card");
    if (!categoryBtns.length || !projectCards.length) return;

    const ACTIVE = ["bg-primary", "text-white", "shadow-md"];
    const INACTIVE = ["text-gray-700"];
    const HOVER = ["hover:bg-gray-100", "hover:text-black"];

    const setActiveBtn = (activeBtn) => {
      categoryBtns.forEach((b) => {
        b.classList.remove(...ACTIVE);
        b.classList.add(...INACTIVE);
        // hover enable for inactive
        b.classList.add(...HOVER);
        b.setAttribute("aria-pressed", "false");
      });

      // active state
      activeBtn.classList.add(...ACTIVE);
      activeBtn.classList.remove(...INACTIVE);
      // hover disable for active (optional)
      activeBtn.classList.remove(...HOVER);
      activeBtn.setAttribute("aria-pressed", "true");
    };

    const applyFilter = (category) => {
      projectCards.forEach((card) => {
        const projectCategory = card.getAttribute("data-category");
        const show = category === "All" || projectCategory === category;
        card.classList.toggle("hidden", !show);
      });
    };

    const firstBtn = categoryBtns[0];
    if (firstBtn) {
      setActiveBtn(firstBtn);
      applyFilter(firstBtn.getAttribute("data-category") || "All");
    }

    categoryBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        const category = btn.getAttribute("data-category") || "All";
        setActiveBtn(btn);
        applyFilter(category);
      });
    });
  }

  document.addEventListener("DOMContentLoaded", initPortfolioFilter);
  document.addEventListener("astro:page-load", initPortfolioFilter);
</script>
