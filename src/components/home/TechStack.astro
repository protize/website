---
import FadeIn from "../animations/FadeIn";

const tabs = [
  {
    key: "frontend",
    label: "Frontend",
    items: [
      { name: "HTML", icon: "/images/tech-stack/html5.svg" },
      { name: "CSS", icon: "/images/tech-stack/css3.webp" },
      { name: "JavaScript", icon: "/images/tech-stack/javascript.svg" },
      { name: "TypeScript", icon: "/images/tech-stack/typescript.svg" },

      { name: "Angular", icon: "/images/tech-stack/angular.svg" },
      { name: "React", icon: "/images/tech-stack/react.svg" },
      { name: "Vue", icon: "/images/tech-stack/vue.svg" },
      { name: "Svelte", icon: "/images/tech-stack/svelte.svg" },

      { name: "Next.js", icon: "/images/tech-stack/nextdotjs.svg" },
      { name: "Astro", icon: "/images/tech-stack/astro.png" },
      { name: "Vite", icon: "/images/tech-stack/vite.svg" },

      { name: "Tailwind", icon: "/images/tech-stack/tailwindcss.svg" },
      { name: "Bootstrap", icon: "/images/tech-stack/bootstrap.svg" },
      { name: "Sass", icon: "/images/tech-stack/sass.svg" },

      { name: "Redux", icon: "/images/tech-stack/redux.svg" },
      { name: "Zustand", icon: "/images/tech-stack/zustand.svg" },
      { name: "React Query", icon: "/images/tech-stack/reactquery.svg" },

      { name: "Framer Motion", icon: "/images/tech-stack/framer.svg" },
      { name: "Three.js", icon: "/images/tech-stack/threedotjs.svg" },
    ],
  },

  {
    key: "backend",
    label: "Backend",
    items: [
      { name: "Node.js", icon: "/images/tech-stack/nodedotjs.svg" },
      { name: "NestJS", icon: "/images/tech-stack/nestjs.svg" },
      { name: "Express", icon: "/images/tech-stack/express.svg" },

      { name: "Python", icon: "/images/tech-stack/python.svg" },
      { name: "FastAPI", icon: "/images/tech-stack/fastapi.svg" },
      { name: "Django", icon: "/images/tech-stack/django.svg" },

      { name: "Java", icon: "/images/tech-stack/java.png" },
      { name: "Spring Boot", icon: "/images/tech-stack/springboot.svg" },
      { name: "Spring", icon: "/images/tech-stack/spring.png" },

      { name: "Go", icon: "/images/tech-stack/go.svg" },
      { name: "Gin", icon: "/images/tech-stack/gin.svg" },

      { name: "PHP", icon: "/images/tech-stack/php.svg" },
      { name: "Laravel", icon: "/images/tech-stack/laravel.svg" },

      { name: "GraphQL", icon: "/images/tech-stack/graphql.svg" },
      { name: "REST APIs", icon: "/images/tech-stack/rest.svg" },

      { name: "Socket.IO", icon: "/images/tech-stack/socketdotio.svg" },
      { name: "gRPC", icon: "/images/tech-stack/grpc.svg" },

      { name: "Auth (JWT/OAuth)", icon: "/images/tech-stack/oauth.svg" },
    ],
  },

  {
    key: "mobile",
    label: "Mobile App",
    items: [
      { name: "Flutter", icon: "/images/tech-stack/flutter.svg" },
      { name: "React Native", icon: "/images/tech-stack/react.svg" },
      { name: "Swift", icon: "/images/tech-stack/swift.svg" },
      { name: "Kotlin", icon: "/images/tech-stack/kotlin.svg" },
      { name: "Ionic", icon: "/images/tech-stack/ionic.svg" },
      { name: "Xamarin", icon: "/images/tech-stack/xamarin.webp" },
      {
        name: "Jetpack Compose",
        icon: "/images/tech-stack/JetpackCompose_logo.png",
      },
      {
        name: ".NET MAUI",
        icon: "/images/tech-stack/dotnetmaui.png",
      },
    ],
  },

  {
    key: "database",
    label: "Database",
    items: [
      { name: "MySQL", icon: "/images/tech-stack/mysql.svg" },
      { name: "PostgreSQL", icon: "/images/tech-stack/postgresql.png" },
      { name: "MongoDB", icon: "/images/tech-stack/mongodb.svg" },
      { name: "Firebase", icon: "/images/tech-stack/firebase.png" },
      { name: "Redis", icon: "/images/tech-stack/redis.svg" },
      { name: "Memcached", icon: "/images/tech-stack/memcached.png" },

      { name: "Elasticsearch", icon: "/images/tech-stack/elastic-search.png" },
      { name: "OpenSearch", icon: "/images/tech-stack/open-search.png" },

      { name: "SQLite", icon: "/images/tech-stack/sqlite.svg" },
      { name: "MariaDB", icon: "/images/tech-stack/mariadb.svg" },

      { name: "DynamoDB", icon: "/images/tech-stack/dynamodb.png" },

      { name: "RabbitMQ", icon: "/images/tech-stack/rabbitmq.svg" },
      { name: "Kafka", icon: "/images/tech-stack/apachekafka.svg" },
    ],
  },

  {
    key: "devops",
    label: "DevOps",
    items: [
      { name: "AWS", icon: "/images/tech-stack/aws.png" },
      { name: "Azure", icon: "/images/tech-stack/azure.jpg" },
      { name: "Google Cloud", icon: "/images/tech-stack/google-cloud.png" },

      { name: "Docker", icon: "/images/tech-stack/docker.svg" },
      { name: "Kubernetes", icon: "/images/tech-stack/kubernetes.svg" },
      { name: "Nginx", icon: "/images/tech-stack/nginx.svg" },

      { name: "Terraform", icon: "/images/tech-stack/terraform.svg" },
      { name: "Ansible", icon: "/images/tech-stack/ansible.png" },

      { name: "GitHub Actions", icon: "/images/tech-stack/githubactions.svg" },
      { name: "GitLab CI", icon: "/images/tech-stack/gitlab.svg" },
      { name: "Jenkins", icon: "/images/tech-stack/jenkins.jpg" },

      { name: "Linux", icon: "/images/tech-stack/linux.svg" },
      { name: "NPM", icon: "/images/tech-stack/npm.svg" },
      { name: "PNPM", icon: "/images/tech-stack/pnpm.svg" },

      { name: "Prometheus", icon: "/images/tech-stack/prometheus.svg" },
      { name: "Grafana", icon: "/images/tech-stack/grafana.svg" },

      { name: "Sentry", icon: "/images/tech-stack/sentry.svg" },
      { name: "New Relic", icon: "/images/tech-stack/newrelic.svg" },

      { name: "CI/CD", icon: "/images/tech-stack/cicd.svg" },
    ],
  },

  {
    key: "ai",
    label: "AI/ML",
    items: [
      { name: "OpenAI", icon: "/images/tech-stack/openai.png" },
      { name: "Google Gemini", icon: "/images/tech-stack/googlegemini.png" },
      { name: "Anthropic", icon: "/images/tech-stack/anthropic.svg" },
      { name: "Meta Llama", icon: "/images/tech-stack/meta.svg" },
      { name: "PyTorch", icon: "/images/tech-stack/pytorch.svg" },
      { name: "TensorFlow", icon: "/images/tech-stack/tensorflow.svg" },
      { name: "scikit-learn", icon: "/images/tech-stack/scikitlearn.svg" },
      { name: "LangChain", icon: "/images/tech-stack/langchain.svg" },
      { name: "LlamaIndex", icon: "/images/tech-stack/llamaindex.svg" },
      { name: "Hugging Face", icon: "/images/tech-stack/huggingface.svg" },
      { name: "MLflow", icon: "/images/tech-stack/mlflow.svg" },
    ],
  },
];

const defaultTab = "frontend";
---

<section
  class="section-padding bg-gray-50 text-black overflow-hidden"
  data-tech-tabs
>
  <div class="container-custom">
    <FadeIn client:load direction="up">
      <div class="text-center max-w-3xl mx-auto mb-12">
        <h2 class="text-4xl md:text-5xl font-heading font-bold mb-4">
          Our Technology <span class="gradient-text">Stack</span>
        </h2>
        <p class="text-xl text-gray-600">
          We leverage the latest technologies to build scalable, efficient, and
          future-proof solutions
        </p>
      </div>

      <!-- Tabs -->
      <div class="mt-8 flex justify-center mb-10">
        <div
          class="inline-flex flex-wrap justify-center gap-2 rounded-2xl border border-gray-200 bg-white/70 backdrop-blur px-2 py-2 shadow-sm"
        >
          {
            tabs.map((t) => (
              <button
                type="button"
                data-tab-trigger={t.key}
                aria-selected={t.key === defaultTab ? "true" : "false"}
                class="tab-pill relative isolate rounded-xl px-4 md:px-5 py-2 text-sm md:text-[15px] font-semibold transition
    focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/40
    text-gray-700 hover:bg-gray-100 hover:text-black"
              >
                <span class="relative z-10">{t.label}</span>
              </button>
            ))
          }
        </div>
      </div>

      <!-- Banner (each tab has its own scroller; only active one is visible) -->
      <div class="relative">
        <div
          class="absolute left-0 top-0 bottom-0 w-20 bg-gradient-to-r from-white to-transparent z-10"
        >
        </div>
        <div
          class="absolute right-0 top-0 bottom-0 w-20 bg-gradient-to-l from-white to-transparent z-10"
        >
        </div>

        {
          tabs.map((t) => {
            const loopItems = [...t.items]; // repeat for infinite feel
            return (
              <div
                class="tab-panel"
                data-tab-panel={t.key}
                hidden={t.key !== defaultTab}
              >
                <div class="overflow-hidden py-4">
                  <div class="flex animate-scroll">
                    {loopItems.map((tech, i) => (
                      <div class="flex-shrink-0 mx-4 bg-white rounded-xl border border-gray-200 hover:border-primary transition-colors px-5 py-3">
                        <div class="flex flex-col items-center gap-3">
                          <img
                            src={tech.icon}
                            alt={tech.name}
                            class="w-20 h-20"
                          />
                          <div class="text-gray-900 font-semibold whitespace-nowrap">
                            {tech.name}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            );
          })
        }
      </div>
    </FadeIn>
  </div>

  <script is:inline define:vars={{ defaultTab }}>
    function initTechTabs() {
      const root = document.querySelector("[data-tech-tabs]");
      if (!root) return;

      const triggers = Array.from(root.querySelectorAll("[data-tab-trigger]"));
      const panels = Array.from(root.querySelectorAll("[data-tab-panel]"));
      if (!triggers.length || !panels.length) return;

      const ACTIVE = ["bg-primary", "text-white", "shadow-md"];
      const INACTIVE = ["text-gray-700"];
      const HOVER = ["hover:bg-gray-100", "hover:text-black"];

      function setActive(key) {
        triggers.forEach((btn) => {
          const active = btn.getAttribute("data-tab-trigger") === key;

          btn.setAttribute("aria-selected", String(active));

          // reset
          btn.classList.remove(...ACTIVE);
          btn.classList.add(...INACTIVE);
          btn.classList.add(...HOVER);

          // active
          if (active) {
            btn.classList.add(...ACTIVE);
            btn.classList.remove(...INACTIVE);
            btn.classList.remove(...HOVER);
          }
        });

        panels.forEach((p) => {
          const show = p.getAttribute("data-tab-panel") === key;
          p.toggleAttribute("hidden", !show);
        });
      }

      triggers.forEach((btn) => {
        btn.addEventListener("click", () => {
          setActive(btn.getAttribute("data-tab-trigger"));
        });
      });

      setActive(defaultTab);
    }

    document.addEventListener("DOMContentLoaded", initTechTabs);
    document.addEventListener("astro:page-load", initTechTabs);
  </script>

  <style>
    @keyframes scroll {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }

    .animate-scroll {
      animation: scroll 28s linear infinite;
      will-change: transform;
    }

    .animate-scroll:hover {
      animation-play-state: paused;
    }
  </style>
</section>
